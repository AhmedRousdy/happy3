<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Weekly Achievements & Plan</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display.swap" rel="stylesheet">
    <style>
        body { font-family: 'Inter', sans-serif; -webkit-print-color-adjust: exact; }
        @media print {
            .no-print { display: none; }
            body { padding: 0; background: white; }
            .container { max-width: 100% !important; box-shadow: none; border: none; }
        }
    </style>
</head>
<body class="bg-gray-50 text-slate-800 p-8">

    <div class="container mx-auto max-w-5xl bg-white p-8 rounded-xl shadow-lg border border-gray-200">
        
        <!-- Header -->
        <div class="border-b border-gray-200 pb-6 mb-8 flex justify-between items-start">
            <div>
                <h1 class="text-3xl font-bold text-blue-900 mb-2">Weekly Achievements & Plan</h1>
                <p class="text-gray-500">Generated on {{ generated_date }}</p>
            </div>
            <div class="text-right">
                <span class="bg-blue-100 text-blue-800 text-sm font-medium px-3 py-1 rounded-full">Week {{ week_number }}</span>
            </div>
        </div>

        <!-- Section 1: Achievements -->
        <div class="mb-10">
            <h2 class="text-xl font-bold text-slate-800 mb-4 flex items-center">
                <span class="bg-green-100 text-green-700 p-1 rounded mr-2">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd" /></svg>
                </span>
                Last Week Achievements <span class="text-gray-400 font-normal ml-2 text-base">({{ date_range_last_week }})</span>
            </h2>

            {% if achievements %}
            <div class="overflow-x-auto">
                <table class="min-w-full text-left text-sm whitespace-nowrap border-collapse">
                    <thead class="uppercase tracking-wider border-b-2 border-gray-200 bg-gray-50 text-gray-600">
                        <tr>
                            <th scope="col" class="px-4 py-3">Project</th>
                            <th scope="col" class="px-4 py-3">Description</th>
                            <th scope="col" class="px-4 py-3">Impact</th>
                            <th scope="col" class="px-4 py-3">Received</th> <!-- NEW -->
                            <th scope="col" class="px-4 py-3">SLA</th>      <!-- NEW -->
                            <th scope="col" class="px-4 py-3 text-center">Effort</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for task in achievements %}
                        <tr class="border-b border-gray-100 hover:bg-gray-50 transition-colors">
                            <td class="px-4 py-3 font-medium text-blue-700 align-top">{{ task.project }}</td>
                            <td class="px-4 py-3 whitespace-normal max-w-xs align-top">{{ task.task_summary }}</td>
                            <td class="px-4 py-3 whitespace-normal max-w-xs text-gray-600 italic align-top">{{ task.business_impact or 'N/A' }}</td>
                            
                            <!-- NEW: Received Date -->
                            <td class="px-4 py-3 align-top text-gray-500">{{ task.received_at }}</td>
                            
                            <!-- NEW: SLA Status -->
                            <td class="px-4 py-3 align-top">
                                {% if task.sla_status == 'Overdue' %}
                                    <span class="inline-flex items-center px-2 py-0.5 rounded text-xs font-medium bg-red-100 text-red-800">Overdue</span>
                                {% else %}
                                    <span class="inline-flex items-center px-2 py-0.5 rounded text-xs font-medium bg-green-100 text-green-800">On Time</span>
                                {% endif %}
                            </td>

                            <td class="px-4 py-3 text-center align-top">{{ task.effort_estimate_hours or '-' }}</td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
            {% else %}
            <div class="p-4 bg-gray-50 rounded-lg text-gray-500 italic text-center">No completed tasks recorded for this period.</div>
            {% endif %}
        </div>

        <!-- Section 2: Planned -->
        <div>
            <h2 class="text-xl font-bold text-slate-800 mb-4 flex items-center">
                <span class="bg-blue-100 text-blue-700 p-1 rounded mr-2">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm1-12a1 1 0 10-2 0v4a1 1 0 00.293.707l2.828 2.829a1 1 0 101.415-1.415L11 9.586V6z" clip-rule="evenodd" /></svg>
                </span>
                Next Week â€“ Planned Achievements <span class="text-gray-400 font-normal ml-2 text-base">({{ date_range_next_week }})</span>
            </h2>

            {% if planned %}
            <div class="overflow-x-auto">
                <table class="min-w-full text-left text-sm whitespace-nowrap border-collapse">
                    <thead class="uppercase tracking-wider border-b-2 border-gray-200 bg-gray-50 text-gray-600">
                        <tr>
                            <th scope="col" class="px-4 py-3">Task / Milestone Name</th>
                            <th scope="col" class="px-4 py-3">Description</th>
                            <th scope="col" class="px-4 py-3">Project</th>
                            <th scope="col" class="px-4 py-3">Risks / Issues</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for task in planned %}
                        <tr class="border-b border-gray-100 hover:bg-gray-50 transition-colors">
                            <td class="px-4 py-3 font-medium flex items-center gap-2 align-top">
                                {% if task.priority == 'high' %}
                                    <span class="w-2 h-2 rounded-full bg-red-500 mt-1" title="High Priority"></span>
                                {% endif %}
                                {{ task.task_summary }}
                            </td>
                            <td class="px-4 py-3 whitespace-normal max-w-xs text-gray-600 align-top">{{ task.task_detail or 'See email for details' }}</td>
                            <td class="px-4 py-3 text-blue-700 align-top">{{ task.project }}</td>
                            <td class="px-4 py-3 text-gray-500 italic align-top">None identified</td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
            {% else %}
            <div class="p-4 bg-gray-50 rounded-lg text-gray-500 italic text-center">No active tasks planned for next week.</div>
            {% endif %}
        </div>
        
        <div class="mt-8 pt-6 border-t border-gray-200 text-center no-print">
            <button onclick="window.print()" class="bg-blue-900 hover:bg-blue-800 text-white font-bold py-2 px-6 rounded-lg transition shadow">
                Print / Save as PDF
            </button>
        </div>

    </div>
</body>
</html>